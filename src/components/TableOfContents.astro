---
interface Props {
  headings: { id: string; text: string }[];
}

const { headings } = Astro.props;
---

{headings.length > 0 && (
  <nav
    id="table-of-contents"
    class="hidden lg:block fixed top-24 right-8 w-56"
    aria-label="Table of contents"
  >
    <div class="sticky top-24">
      <h2 class="text-[10px] font-semibold uppercase tracking-[0.15em] text-stone-500 mb-3">
        In this page
      </h2>
      <ul class="space-y-2 text-xs border-l-2 border-stone-300 dark:border-stone-700">
        {headings.map((heading) => (
          <li>
            <a
              href={`#${heading.id}`}
              class="toc-link block py-1 pl-3 -ml-[2px] border-l-2 transition-colors
                     text-stone-600 dark:text-stone-400 hover:text-stone-800 dark:hover:text-stone-300
                     border-transparent hover:border-stone-400 dark:hover:border-stone-500
                     data-[active]:border-sky-600 data-[active]:text-sky-700
                     dark:data-[active]:border-sky-400 dark:data-[active]:text-sky-400"
              data-target={heading.id}
            >
              {heading.text}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </nav>
)}

<script>
  // Intersection Observer for scroll tracking
  const observerOptions = {
    rootMargin: '-80px 0px -66% 0px',
    threshold: 0
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      const id = entry.target.getAttribute('id');
      const tocLink = document.querySelector(`.toc-link[data-target="${id}"]`);

      if (entry.isIntersecting && tocLink) {
        // Remove active state from all links
        document.querySelectorAll('.toc-link').forEach((link) => {
          delete (link as HTMLElement).dataset.active;
        });

        // Set active state on current link
        (tocLink as HTMLElement).dataset.active = '';
      }
    });
  }, observerOptions);

  // Observe all h2 elements in the article
  document.addEventListener('DOMContentLoaded', () => {
    const headings = document.querySelectorAll('article h2[id]');
    headings.forEach((heading) => observer.observe(heading));
  });
</script>
