---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import DocsLayout from '../../../layouts/DocsLayout.astro';

export const getStaticPaths = (async () => {
  const docs = await getCollection('moat');

  return docs.map((doc) => {
    const parts = doc.id.split('/');
    const category = parts[0];
    const fileName = parts[1];
    const slug = fileName.replace(/^\d+-/, '').replace(/\.md$/, '');

    return {
      params: { category, slug },
      props: { doc, category },
    };
  });
}) satisfies GetStaticPaths;

const { doc, category } = Astro.props;
const { Content, headings } = await doc.render();
const title = doc.data.title || doc.id;

// Extract H2 headings for table of contents
const h2Headings = headings
  .filter((h) => h.depth === 2)
  .map((h) => ({ id: h.slug, text: h.text }));

// Format category for display
const categoryLabel = category
  .split('-')
  .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))
  .join(' ');
---

<DocsLayout title={title} description={doc.data.description} headings={h2Headings}>
  <div class="inline-block bg-sky-100 px-3 py-0.5 mb-6">
    <span class="text-[10px] font-semibold uppercase tracking-[0.15em] text-sky-700">
      {categoryLabel}
    </span>
  </div>
  <Content />
</DocsLayout>
