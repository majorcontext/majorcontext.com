---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;
const currentPath = Astro.url.pathname;
---

<BaseLayout title={title} description={description}>
  <div class="min-h-screen">
    <!-- Mobile Menu Toggle -->
    <button
      id="mobile-menu-toggle"
      class="fixed top-4 right-4 z-50 md:hidden bg-stone-800 text-stone-100 p-2 rounded-sm"
      aria-label="Toggle menu"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    <!-- Sidebar -->
    <aside
      id="sidebar"
      class="w-64 bg-stone-200 fixed h-full overflow-y-auto z-40
             transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out"
    >
      <div class="p-4 md:p-6">

        <nav class="space-y-6">
          <!-- Getting Started -->
          <div>
            <h2 class="text-xs font-semibold uppercase tracking-[0.2em] text-stone-400 mb-3 pb-3 border-b border-stone-300">
              Getting Started
            </h2>
            <ul>
              <li>
                <a href="/moat/getting-started/introduction"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/getting-started/introduction')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">01</span>
                  Introduction
                </a>
              </li>
              <li>
                <a href="/moat/getting-started/installation"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/getting-started/installation')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">02</span>
                  Installation
                </a>
              </li>
              <li>
                <a href="/moat/getting-started/quick-start"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/getting-started/quick-start')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">03</span>
                  Quick Start
                </a>
              </li>
              <li>
                <a href="/moat/getting-started/comparison"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/getting-started/comparison')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">04</span>
                  Comparison
                </a>
              </li>
            </ul>
          </div>

          <!-- Concepts -->
          <div>
            <h2 class="text-xs font-semibold uppercase tracking-[0.2em] text-stone-400 mb-3 pb-3 border-b border-stone-300">
              Concepts
            </h2>
            <ul>
              <li>
                <a href="/moat/concepts/sandboxing"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/concepts/sandboxing')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">01</span>
                  Sandboxing
                </a>
              </li>
              <li>
                <a href="/moat/concepts/credentials"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/concepts/credentials')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">02</span>
                  Credentials
                </a>
              </li>
              <li>
                <a href="/moat/concepts/audit-logs"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/concepts/audit-logs')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">03</span>
                  Audit Logs
                </a>
              </li>
              <li>
                <a href="/moat/concepts/observability"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/concepts/observability')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">04</span>
                  Observability
                </a>
              </li>
              <li>
                <a href="/moat/concepts/networking"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/concepts/networking')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">05</span>
                  Networking
                </a>
              </li>
              <li>
                <a href="/moat/concepts/dependencies"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/concepts/dependencies')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">06</span>
                  Dependencies
                </a>
              </li>
            </ul>
          </div>

          <!-- Guides -->
          <div>
            <h2 class="text-xs font-semibold uppercase tracking-[0.2em] text-stone-400 mb-3 pb-3 border-b border-stone-300">
              Guides
            </h2>
            <ul>
              <li>
                <a href="/moat/guides/running-claude-code"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/guides/running-claude-code')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">01</span>
                  Claude Code
                </a>
              </li>
              <li>
                <a href="/moat/guides/running-codex"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/guides/running-codex')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">02</span>
                  Codex
                </a>
              </li>
              <li>
                <a href="/moat/guides/ssh-access"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/guides/ssh-access')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">03</span>
                  SSH Access
                </a>
              </li>
              <li>
                <a href="/moat/guides/secrets-management"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/guides/secrets-management')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">04</span>
                  Secrets
                </a>
              </li>
              <li>
                <a href="/moat/guides/multi-agent"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/guides/multi-agent')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">05</span>
                  Multi-Agent
                </a>
              </li>
              <li>
                <a href="/moat/guides/snapshots"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/guides/snapshots')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">06</span>
                  Snapshots
                </a>
              </li>
            </ul>
          </div>

          <!-- Reference -->
          <div>
            <h2 class="text-xs font-semibold uppercase tracking-[0.2em] text-stone-400 mb-3 pb-3 border-b border-stone-300">
              Reference
            </h2>
            <ul>
              <li>
                <a href="/moat/reference/cli"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/reference/cli')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">01</span>
                  CLI
                </a>
              </li>
              <li>
                <a href="/moat/reference/agent-yaml"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/reference/agent-yaml')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">02</span>
                  agent.yaml
                </a>
              </li>
              <li>
                <a href="/moat/reference/environment"
                   class:list={[
                     "flex items-center gap-2 px-0 py-1.5 text-sm border-l-2 transition-colors",
                     currentPath.includes('/reference/environment')
                       ? "text-stone-800 bg-stone-100 border-l-sky-700"
                       : "text-stone-600 border-transparent hover:text-stone-800"
                   ]}>
                  <span class="text-[10px] text-stone-400 w-6">03</span>
                  Environment
                </a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </aside>

    <!-- Overlay for mobile -->
    <div
      id="sidebar-overlay"
      class="fixed inset-0 bg-stone-900/50 z-30 hidden md:hidden"
    ></div>

    <!-- Main Content -->
    <main class="md:ml-64 pt-16 md:pt-0">
      <article class="max-w-3xl mx-auto px-6 md:px-12 py-8 md:py-12">
        <div class="prose prose-stone max-w-none
                    prose-headings:font-serif prose-headings:tracking-tight
                    prose-h1:text-3xl md:prose-h1:text-5xl prose-h1:font-normal prose-h1:leading-tight prose-h1:mb-4 md:prose-h1:mb-6
                    prose-h2:text-xl md:prose-h2:text-2xl prose-h2:font-normal prose-h2:mt-8 md:prose-h2:mt-12 prose-h2:mb-3 md:prose-h2:mb-4
                    prose-h3:text-base md:prose-h3:text-lg prose-h3:font-semibold prose-h3:mt-6 md:prose-h3:mt-8 prose-h3:mb-2 md:prose-h3:mb-3
                    prose-p:leading-relaxed prose-p:mb-4 prose-p:text-sm md:prose-p:text-base
                    prose-a:text-sky-700 prose-a:no-underline hover:prose-a:text-sky-800 hover:prose-a:underline
                    prose-code:font-mono prose-code:text-xs md:prose-code:text-sm prose-code:bg-stone-200 prose-code:border prose-code:border-stone-300 prose-code:px-1.5 prose-code:py-0.5 prose-code:text-stone-700 prose-code:rounded-sm
                    prose-code:before:content-none prose-code:after:content-none
                    prose-pre:bg-stone-900 prose-pre:border-0 prose-pre:p-4 md:prose-pre:p-6 prose-pre:leading-loose prose-pre:overflow-x-auto
                    [&_pre_code]:!bg-transparent [&_pre_code]:!border-0 [&_pre_code]:!p-0 [&_pre_code]:!text-stone-200 [&_pre_code]:text-xs [&_pre_code]:md:text-sm
                    prose-strong:text-stone-800 prose-strong:font-semibold
                    prose-ul:my-4 prose-li:my-1
                    prose-hr:border-stone-300
                    prose-table:text-sm prose-table:overflow-x-auto">
          <slot />
        </div>
      </article>
    </main>
  </div>

  <script>
    const toggle = document.getElementById('mobile-menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    function openSidebar(): void {
      sidebar?.classList.remove('-translate-x-full');
      overlay?.classList.remove('hidden');
    }

    function closeSidebar(): void {
      sidebar?.classList.add('-translate-x-full');
      overlay?.classList.add('hidden');
    }

    toggle?.addEventListener('click', () => {
      if (sidebar?.classList.contains('-translate-x-full')) {
        openSidebar();
      } else {
        closeSidebar();
      }
    });

    overlay?.addEventListener('click', closeSidebar);

    // Close sidebar on navigation (mobile only)
    const links = sidebar?.querySelectorAll('a');
    links?.forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth < 768) {
          closeSidebar();
        }
      });
    });
  </script>
</BaseLayout>
